<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Gi√°ng Sinh 360¬∞ Ultimate</title>
<style>
body{margin:0;overflow:hidden;background:#000}

/* Overlay l·ªùi ch√∫c */
#wishes{
 position:fixed;
 bottom:40px;
 width:100%;
 text-align:center;
 font-size:22px;
 font-family:'Segoe UI',sans-serif;
 pointer-events:none;
}
.wish{
 opacity:0;
 animation:fade 5s forwards;
}
@keyframes fade{
 from{opacity:0;transform:translateY(10px)}
 to{opacity:1}
}

/* S√≥ng nh·∫°c */
#visualizer{
 position:fixed;
 bottom:0;
 left:0;
 width:100%;
 height:80px;
}
</style>
</head>
<body>

<canvas id="visualizer"></canvas>
<div id="wishes"></div>
<audio id="music" src="music.mp3" loop crossorigin="anonymous"></audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>

<script>
// ===== THREE.JS SETUP =====
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,1000);
camera.position.set(0,2,7);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

const controls=new THREE.OrbitControls(camera,renderer.domElement);
controls.enableZoom=false;
controls.enablePan=false;

scene.add(new THREE.AmbientLight(0xffffff,.8));
const light=new THREE.PointLight(0xffffff,1);
light.position.set(5,5,5);
scene.add(light);

// ===== C√ÇY TH√îNG (C·ªê ƒê·ªäNH) =====
const tree=new THREE.Group();
function cone(y,r,h,c){
 const m=new THREE.MeshStandardMaterial({color:c});
 const g=new THREE.Mesh(new THREE.ConeGeometry(r,h,32),m);
 g.position.y=y;
 return g;
}
tree.add(cone(0,1.3,2.3,0x0f8f3a));
tree.add(cone(1,1.1,2,0x11a040));
tree.add(cone(2,0.9,1.7,0x14b94a));

// sao
const star=new THREE.Mesh(
 new THREE.OctahedronGeometry(0.25),
 new THREE.MeshStandardMaterial({color:0xffd700})
);
star.position.y=3.3;
tree.add(star);

// ƒë√®n nh·∫•p nh√°y
const bulbs=[];
for(let i=0;i<35;i++){
 const b=new THREE.Mesh(
  new THREE.SphereGeometry(0.05),
  new THREE.MeshStandardMaterial({color:Math.random()*0xffffff})
 );
 b.position.set(
  (Math.random()-.5)*1.5,
  Math.random()*2.5,
  (Math.random()-.5)*1.5
 );
 bulbs.push(b);
 tree.add(b);
}
scene.add(tree);

// ===== ·∫¢NH 1:1 =====
const tex=new THREE.TextureLoader().load('image.jpg');
const photo=new THREE.Mesh(
 new THREE.PlaneGeometry(1.6,1.6),
 new THREE.MeshBasicMaterial({map:tex})
);
photo.position.set(2.5,1.6,0);
scene.add(photo);

// ===== NH√Ä TUY·∫æT =====
const house=new THREE.Mesh(
 new THREE.CylinderGeometry(1,1,1.2,16),
 new THREE.MeshStandardMaterial({color:0xffffff})
);
house.position.set(-3,0.6,-1);
scene.add(house);

// ===== √îNG GI√Ä NOEL BAY =====
const santa=new THREE.Mesh(
 new THREE.SphereGeometry(0.25),
 new THREE.MeshStandardMaterial({color:0xff0000})
);
scene.add(santa);

// ===== TUY·∫æT =====
const snowGeo=new THREE.BufferGeometry();
const snowPos=[];
for(let i=0;i<1000;i++){
 snowPos.push(
  (Math.random()-0.5)*40,
  Math.random()*20,
  (Math.random()-0.5)*40
 );
}
snowGeo.setAttribute('position',new THREE.Float32BufferAttribute(snowPos,3));
const snow=new THREE.Points(
 snowGeo,
 new THREE.PointsMaterial({color:0xffffff,size:0.05})
);
scene.add(snow);

// ===== H·ªòP QU√Ä =====
const gifts=[];
setInterval(()=>{
 const g=new THREE.Mesh(
  new THREE.BoxGeometry(0.4,0.4,0.4),
  new THREE.MeshStandardMaterial({color:Math.random()*0xffffff})
 );
 g.position.set((Math.random()-0.5)*6,6,(Math.random()-0.5)*6);
 scene.add(g);
 gifts.push(g);
},900);

// ===== NH·∫†C + S√ìNG =====
const audio=document.getElementById("music");
const ctx=new AudioContext();
const src=ctx.createMediaElementSource(audio);
const analyser=ctx.createAnalyser();
src.connect(analyser);
analyser.connect(ctx.destination);
analyser.fftSize=256;
const data=new Uint8Array(analyser.frequencyBinCount);

document.body.addEventListener("click",()=>{
 ctx.resume();
 audio.play();
},{once:true});

// visualizer
const canvas=document.getElementById("visualizer");
const vctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=80;

// ===== L·ªúI CH√öC =====
const texts=[
"üéÑ Ch√∫c b·∫°n m·ªôt m√πa Gi√°ng Sinh an l√†nh v√† ·∫•m √°p.",
"‚ú® Mong r·∫±ng y√™u th∆∞∆°ng lu√¥n bao quanh b·∫°n m·ªói ng√†y.",
"‚ùÑÔ∏è M·ªçi lo toan s·∫Ω tan bi·∫øn, ch·ªâ c√≤n l·∫°i n·ª• c∆∞·ªùi.",
"üéÅ M·ªôt nƒÉm m·ªõi b√¨nh an v√† ƒë·∫ßy hy v·ªçng ƒëang ƒë·∫øn."
];
let ti=0;
const wishBox=document.getElementById("wishes");
function showWish(){
 wishBox.innerHTML="";
 const d=document.createElement("div");
 d.className="wish";
 d.style.color=`hsl(${Math.random()*360},100%,70%)`;
 d.innerText=texts[ti];
 wishBox.appendChild(d);
 ti=(ti+1)%texts.length;
}
showWish();
setInterval(showWish,4500);

// ===== ANIMATE =====
let t=0;
function animate(){
 requestAnimationFrame(animate);
 t+=0.01;

 // santa bay v√≤ng
 santa.position.set(Math.cos(t)*4,2,Math.sin(t)*4);

 // ƒë√®n nh·∫•p nh√°y
 bulbs.forEach(b=>b.material.color.setHSL(Math.random(),1,.6));

 // tuy·∫øt r∆°i
 const p=snow.geometry.attributes.position.array;
 for(let i=1;i<p.length;i+=3){
  p[i]-=0.04;
  if(p[i]<0)p[i]=20;
 }
 snow.geometry.attributes.position.needsUpdate=true;

 // qu√† r∆°i
 gifts.forEach(g=>{
  g.position.y-=0.06;
  if(g.position.y<-2) scene.remove(g);
 });

 // v·∫Ω s√≥ng nh·∫°c
 analyser.getByteFrequencyData(data);
 vctx.clearRect(0,0,canvas.width,canvas.height);
 data.forEach((v,i)=>{
  vctx.fillStyle=`hsl(${i*4},100%,60%)`;
  vctx.fillRect(i*4,80-v/2,3,v/2);
 });

 renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
